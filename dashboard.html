<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />

  <!-- ì¦‰ì‹œ ë¡œê·¸ì¸ ì„¸ì…˜ ê²€ì¦ (ì§ì ‘ URL ì…ë ¥ ì°¨ë‹¨) -->
  <script>
    (function () {
      try {
        const raw = localStorage.getItem("korual_user");
        if (!raw) return location.replace("index.html");
        const user = JSON.parse(raw);
        if (!user || !user.username) return location.replace("index.html");
      } catch (e) {
        return location.replace("index.html");
      }
    })();
  </script>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KORUAL CONTROL CENTER</title>

  <!-- High-End ìŠ¤íƒ€ì¼ -->
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="modal.css" />
</head>

<body class="theme-dark">
  <!-- ê¸€ë¡œë²Œ ë¡œë”© ìŠ¤í”¼ë„ˆ -->
  <div id="globalSpinner" class="spinner-overlay hidden">
    <div class="spinner-core">
      <div class="spinner-ring"></div>
      <div class="spinner-dot"></div>
      <div class="spinner-label">KORUAL ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦</div>
    </div>
  </div>

  <!-- í† ìŠ¤íŠ¸ ë£¨íŠ¸ -->
  <div id="toastRoot" class="toast-container"></div>

  <div class="app-shell">

    <!-- ======================================
         â–  ì‚¬ì´ë“œë°” (Glass + High-End)
    ======================================= -->
    <aside class="sidebar">
      <div class="brand-block">
        <div class="brand-title">KORUAL</div>
        <div class="brand-subtitle">Control Center</div>
      </div>

      <nav class="nav">
        <button class="nav-link active" data-section="dashboard">
          <span class="nav-emoji">ğŸ“Š</span>
          <span>ëŒ€ì‹œë³´ë“œ</span>
        </button>
        <button class="nav-link" data-section="products">
          <span class="nav-emoji">ğŸ“¦</span>
          <span>ìƒí’ˆ ê´€ë¦¬</span>
        </button>
        <button class="nav-link" data-section="orders">
          <span class="nav-emoji">ğŸ“®</span>
          <span>ì£¼ë¬¸ ê´€ë¦¬</span>
        </button>
        <button class="nav-link" data-section="members">
          <span class="nav-emoji">ğŸ§‘â€ğŸ¤â€ğŸ§‘</span>
          <span>íšŒì› ê´€ë¦¬</span>
        </button>
        <button class="nav-link" data-section="stock">
          <span class="nav-emoji">ğŸ¬</span>
          <span>ì¬ê³  ê´€ë¦¬</span>
        </button>
        <button class="nav-link" data-section="logs">
          <span class="nav-emoji">ğŸ“</span>
          <span>ë¡œê·¸ ëª¨ë‹ˆí„°ë§</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <div class="api-status-row">
          <div class="api-status-label">API ì—°ê²° ìƒíƒœ</div>
          <div class="api-status-dot-wrap">
            <span id="apiStatusDot" class="status-dot"></span>
            <span id="apiStatusText" class="api-status-text">Checkingâ€¦</span>
          </div>
        </div>
        <div class="api-meta">
          Ping <span id="apiPing">- ms</span>
        </div>
      </div>
    </aside>

    <!-- ëª¨ë°”ì¼ì¼ ë•Œ ì‚¬ì´ë“œë°” ë’¤ ì–´ë‘ìš´ ë°°ê²½ -->
    <div id="sidebarBackdrop" class="sidebar-backdrop"></div>

    <!-- ======================================
         â–  ë©”ì¸ ì»¨í…ì¸ 
    ======================================= -->
    <main class="content">

      <!-- ìƒë‹¨ë°” (Topbar) -->
      <header class="topbar">
        <div class="topbar-left">
          <!-- ëª¨ë°”ì¼ ë©”ë‰´ ë²„íŠ¼ -->
          <button id="menuToggle" class="mobile-menu-btn" type="button" aria-label="ë©”ë‰´ ì—´ê¸°">
            <span></span><span></span><span></span>
          </button>

          <div class="topbar-text">
            <div class="topbar-title">
              KORUAL CONTROL CENTER
              <span class="topbar-badge">LIVE</span>
            </div>
            <div class="topbar-meta">
              ë°˜ê°‘ìŠµë‹ˆë‹¤, <span id="welcomeUser">KORUAL</span>ë‹˜
              <span class="topbar-divider">Â·</span>
              <span class="last-sync" id="last-sync">ë§ˆì§€ë§‰ ë™ê¸°í™” ëŒ€ê¸° ì¤‘â€¦</span>
            </div>
          </div>
        </div>

        <div class="topbar-right">
          <!-- í…Œë§ˆ í† ê¸€ -->
          <button id="themeToggle" class="theme-toggle" type="button">
            <span class="theme-toggle-label" data-light="Light" data-dark="Dark">Dark</span>
            <span class="theme-toggle-track">
              <span class="theme-toggle-thumb"></span>
            </span>
          </button>

          <!-- ì „ì²´ ìƒˆë¡œê³ ì¹¨ -->
          <button id="btnRefreshAll" class="primary-btn" type="button">
            ğŸ”„ ì „ì²´ ìƒˆë¡œê³ ì¹¨
          </button>

          <!-- ë¡œê·¸ì•„ì›ƒ -->
          <button id="btnLogout" class="ghost-btn logout-btn" type="button">
            ë¡œê·¸ì•„ì›ƒ
          </button>
        </div>
      </header>

      <!-- ============================================================
           1) ëŒ€ì‹œë³´ë“œ
      ============================================================ -->
      <section id="section-dashboard" class="section active">
        <div class="section-header-row">
          <div>
            <h2>ğŸ“Š ëŒ€ì‹œë³´ë“œ</h2>
            <p class="section-desc">
              KORUAL ì „ ì±„ë„ ë°ì´í„°ë¥¼ í•œëˆˆì— ë³´ëŠ” í•˜ì´ì—”ë“œ ê´€ì œíƒ‘ì…ë‹ˆë‹¤.
            </p>
          </div>
          <div class="section-actions">
            <span class="section-kpi-pill">ì‹¤ì‹œê°„ ìš”ì•½ ëª¨ë“œ</span>
          </div>
        </div>

        <!-- ìš”ì•½ ì¹´ë“œ -->
        <div class="cards-grid">
          <div class="card card-metric">
            <div class="card-label">ì´ ìƒí’ˆ ìˆ˜</div>
            <div class="card-value" id="cardTotalProducts">-</div>
            <div class="card-submeta">PRODUCTS ì‹œíŠ¸ ê¸°ì¤€</div>
          </div>

          <div class="card card-metric">
            <div class="card-label">ì´ ì£¼ë¬¸ ìˆ˜</div>
            <div class="card-value" id="cardTotalOrders">-</div>
            <div class="card-submeta">ORDERS ì‹œíŠ¸ ê¸°ì¤€</div>
          </div>

          <div class="card card-metric">
            <div class="card-label">ì¶”ì • ë§¤ì¶œ í•©ê³„</div>
            <div class="card-value" id="cardTotalRevenue">-</div>
            <div class="card-submeta">ì£¼ë¬¸ ê¸ˆì•¡ í•©ê³„(ì›í™”)</div>
          </div>

          <div class="card card-metric">
            <div class="card-label">íšŒì› ìˆ˜</div>
            <div class="card-value" id="cardTotalMembers">-</div>
            <div class="card-submeta">MEMBERS ì‹œíŠ¸ ê¸°ì¤€</div>
          </div>
        </div>

        <!-- ì˜¤ëŠ˜ ìš”ì•½ -->
        <div class="panel">
          <div class="panel-header">
            <h3>ì˜¤ëŠ˜ ìš”ì•½</h3>
            <div class="panel-header-meta">
              <span id="todayDateLabel"></span>
            </div>
          </div>

          <div class="panel-body">
            <div class="today-metrics">
              <div class="today-metric">
                <span class="today-label">ì˜¤ëŠ˜ ì£¼ë¬¸</span>
                <span class="today-value" id="todayOrders">-</span>
                <span class="today-caption">ì‹ ê·œ ORDERS ì¹´ìš´íŠ¸</span>
              </div>

              <div class="today-metric">
                <span class="today-label">ì˜¤ëŠ˜ ë§¤ì¶œ</span>
                <span class="today-value" id="todayRevenue">-</span>
                <span class="today-caption">ë‹¹ì¼ í•©ê³„ ê¸ˆì•¡</span>
              </div>

              <div class="today-metric">
                <span class="today-label">ì¤€ë¹„ì¤‘ ì£¼ë¬¸</span>
                <span class="today-value" id="todayPending">-</span>
                <span class="today-caption">ìƒíƒœì— "ì¤€ë¹„ì¤‘" í¬í•¨</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ìµœê·¼ ì£¼ë¬¸ -->
        <div class="panel">
          <div class="panel-header">
            <h3>ìµœê·¼ ì£¼ë¬¸</h3>
            <div class="panel-header-actions">
              <button id="goOrders" class="ghost-btn small" type="button">
                â†’ ì£¼ë¬¸ ê´€ë¦¬ ë°”ë¡œê°€ê¸°
              </button>
            </div>
          </div>

          <div class="panel-body">
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ì£¼ë¬¸ì¼ì</th>
                    <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                    <th>ìƒí’ˆëª…</th>
                    <th>ìˆ˜ëŸ‰</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ì±„ë„</th>
                    <th>ìƒíƒœ</th>
                  </tr>
                </thead>
                <tbody id="recentOrdersBody">
                  <tr>
                    <td colspan="7" class="empty-state">ìµœê·¼ ì£¼ë¬¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================================
           2) ìƒí’ˆ ê´€ë¦¬
      ============================================================ -->
      <section id="section-products" class="section">
        <div class="section-header-row">
          <div>
            <h2>ğŸ“¦ ìƒí’ˆ ê´€ë¦¬</h2>
            <p class="section-desc">
              ìì‚¬ëª°, ë§ˆì¼“, Shopee ë“± ì „ ì±„ë„ ìƒí’ˆ ì •ë³´ë¥¼ í•œ ê³³ì—ì„œ í™•ì¸í•©ë‹ˆë‹¤.
            </p>
          </div>

          <div class="section-actions">
            <input
              id="searchProducts"
              class="input"
              placeholder="ê²€ìƒ‰ (ìƒí’ˆëª… / ì½”ë“œ / ì˜µì…˜ / ì±„ë„)"
            />
          </div>
        </div>

        <div class="panel">
          <div class="panel-body">
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ìƒí’ˆì½”ë“œ</th>
                    <th>ìƒí’ˆëª…</th>
                    <th>ì˜µì…˜</th>
                    <th>íŒë§¤ê°€</th>
                    <th>ì¬ê³ </th>
                    <th>ì±„ë„</th>
                  </tr>
                </thead>
                <tbody
                  id="productsBody"
                  data-entity="products"
                  data-sheet="PRODUCTS"
                >
                  <tr>
                    <td colspan="6" class="empty-state">ìƒí’ˆ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="table-footer">
              <div class="pager" id="productsPager">
                <button type="button" data-page="prev">ì´ì „</button>
                <span data-page-label>-</span>
                <button type="button" data-page="next">ë‹¤ìŒ</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================================
           3) ì£¼ë¬¸ ê´€ë¦¬
      ============================================================ -->
      <section id="section-orders" class="section">
        <div class="section-header-row">
          <div>
            <h2>ğŸ“® ì£¼ë¬¸ ê´€ë¦¬</h2>
            <p class="section-desc">
              ì „ì²´ ì£¼ë¬¸ íë¦„ê³¼ ë°°ì†¡ ìƒíƒœë¥¼ KORUAL ê´€ì œíƒ‘ ê¸°ì¤€ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.
            </p>
          </div>

          <div class="section-actions">
            <input
              id="searchOrders"
              class="input"
              placeholder="ê²€ìƒ‰ (ì£¼ë¬¸ë²ˆí˜¸ / ê³ ê°ëª… / ìƒíƒœ / ì±„ë„)"
            />
          </div>
        </div>

        <div class="panel">
          <div class="panel-body">
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>íšŒì›ë²ˆí˜¸</th>
                    <th>ë‚ ì§œ</th>
                    <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                    <th>ê³ ê°ëª…</th>
                    <th>ìƒí’ˆëª…</th>
                    <th>ìˆ˜ëŸ‰</th>
                    <th>ê¸ˆì•¡</th>
                    <th>ìƒíƒœ</th>
                    <th>ì±„ë„</th>
                  </tr>
                </thead>
                <tbody
                  id="ordersBody"
                  data-entity="orders"
                  data-sheet="ORDERS"
                >
                  <tr>
                    <td colspan="9" class="empty-state">ì£¼ë¬¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="table-footer">
              <div class="pager" id="ordersPager">
                <button type="button" data-page="prev">ì´ì „</button>
                <span data-page-label>-</span>
                <button type="button" data-page="next">ë‹¤ìŒ</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================================
           4) íšŒì› ê´€ë¦¬
      ============================================================ -->
      <section id="section-members" class="section">
        <div class="section-header-row">
          <div>
            <h2>ğŸ§‘â€ğŸ¤â€ğŸ§‘ íšŒì› ê´€ë¦¬</h2>
            <p class="section-desc">
              VIP, ë©¤ë²„ì‹­ ë“±ê¸‰, ëˆ„ì  ë§¤ì¶œì„ ê¸°ë°˜ìœ¼ë¡œ KORUAL íšŒì› í’€ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
            </p>
          </div>

          <div class="section-actions" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
            <input
              id="searchMembers"
              class="input"
              placeholder="ê²€ìƒ‰ (íšŒì›ë²ˆí˜¸ / ì´ë¦„ / ì´ë©”ì¼ / ì „í™”ë²ˆí˜¸ / ë“±ê¸‰)"
            />
          </div>
        </div>

        <div class="panel">
          <div class="panel-body">
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>íšŒì›ë²ˆí˜¸</th>
                    <th>ì´ë¦„</th>
                    <th>ì „í™”ë²ˆí˜¸</th>
                    <th>ì´ë©”ì¼</th>
                    <th>ê°€ì…ì¼</th>
                    <th>ì±„ë„</th>
                    <th>ë“±ê¸‰</th>
                    <th>ëˆ„ì ë§¤ì¶œ</th>
                    <th>í¬ì¸íŠ¸</th>
                    <th>ìµœê·¼ì£¼ë¬¸ì¼</th>
                    <th>ë©”ëª¨</th>
                    <th>ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody
                  id="membersBody"
                  data-entity="members"
                  data-sheet="MEMBERS"
                >
                  <tr>
                    <td colspan="12" class="empty-state">íšŒì› ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="table-footer">
              <div class="pager" id="membersPager">
                <button type="button" data-page="prev">ì´ì „</button>
                <span data-page-label>-</span>
                <button type="button" data-page="next">ë‹¤ìŒ</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================================
           5) ì¬ê³  ê´€ë¦¬
      ============================================================ -->
      <section id="section-stock" class="section">
        <div class="section-header-row">
          <div>
            <h2>ğŸ¬ ì¬ê³  ê´€ë¦¬</h2>
            <p class="section-desc">
              ì…ê³ /ì¶œê³  ì—†ì´ë„ ìë™ ê³„ì‚°ëœ ì¬ê³ ë¥¼ ì°½ê³ Â·ì±„ë„ ë‹¨ìœ„ë¡œ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.
            </p>
          </div>

          <div class="section-actions">
            <input
              id="searchStock"
              class="input"
              placeholder="ê²€ìƒ‰ (ìƒí’ˆì½”ë“œ / ìƒí’ˆëª… / ìƒíƒœ / ì°½ê³  / ì±„ë„)"
            />
          </div>
        </div>

        <div class="panel">
          <div class="panel-body">
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ìƒí’ˆì½”ë“œ</th>
                    <th>ìƒí’ˆëª…</th>
                    <th>í˜„ì¬ ì¬ê³ </th>
                    <th>ì•ˆì „ ì¬ê³ </th>
                    <th>ìƒíƒœ</th>
                    <th>ì°½ê³ </th>
                    <th>ì±„ë„</th>
                    <th>ê´€ë¦¬</th>
                  </tr>
                </thead>
                <tbody
                  id="stockBody"
                  data-entity="stock"
                  data-sheet="STOCK"
                >
                  <tr>
                    <td colspan="8" class="empty-state">ì¬ê³  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="table-footer">
              <div class="pager" id="stockPager">
                <button type="button" data-page="prev">ì´ì „</button>
                <span data-page-label>-</span>
                <button type="button" data-page="next">ë‹¤ìŒ</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================================
           6) ë¡œê·¸ ëª¨ë‹ˆí„°ë§
      ============================================================ -->
      <section id="section-logs" class="section">
        <div class="section-header-row">
          <div>
            <h2>ğŸ“ ë¡œê·¸ ëª¨ë‹ˆí„°ë§</h2>
          <p class="section-desc">
              ìë™í™” ìŠ¤í¬ë¦½íŠ¸, API í˜¸ì¶œ, ì•Œë¦¼ ê¸°ë¡ì„ í•œ ë²ˆì— ì¶”ì í•©ë‹ˆë‹¤.
            </p>
          </div>

          <div class="section-actions">
            <input
              id="searchLogs"
              class="input"
              placeholder="ê²€ìƒ‰ (ì‹œê°„ / íƒ€ì… / ë©”ì‹œì§€ / ìƒì„¸)"
            />
          </div>
        </div>

        <div class="panel">
          <div class="panel-body">
            <div class="table-wrapper">
              <table>
                <thead>
                  <tr>
                    <th>ì‹œê°„</th>
                    <th>íƒ€ì…</th>
                    <th>ë©”ì‹œì§€</th>
                    <th>ìƒì„¸</th>
                  </tr>
                </thead>
                <tbody
                  id="logsBody"
                  data-entity="logs"
                  data-sheet="LOGS"
                >
                  <tr>
                    <td colspan="4" class="empty-state">ë¡œê·¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤â€¦</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="table-footer">
              <div class="pager" id="logsPager">
                <button type="button" data-page="prev">ì´ì „</button>
                <span data-page-label>-</span>
                <button type="button" data-page="next">ë‹¤ìŒ</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ============================================================
           FOOTER
      ============================================================ -->
      <footer class="footer">
        <div class="footer-inner">
          <span>Â© 2025 KORUAL Control Center Â· All Systems Automated</span>
        </div>
      </footer>

    </main> <!-- /content -->
  </div> <!-- /app-shell -->

  <!-- ============================================================
       â–  ìˆ˜ì •/ì‚­ì œ ê³µí†µ ëª¨ë‹¬ ë ˆì´ì–´
  ============================================================ -->
  <div
    id="korualModalLayer"
    class="modal-layer"
    data-modal-layer
    style="display:none;"
  >
    <div id="korualModalBackdrop" class="modal-backdrop"></div>

    <!-- ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="rowEditModal" class="modal-panel" data-type="edit">
      <div class="modal-header">
        <h3 class="modal-title">
          <span>í–‰ ìˆ˜ì •</span>
        </h3>
        <button type="button" class="modal-close-btn" data-close-modal>âœ•</button>
      </div>

      <div class="modal-body">
        <div class="modal-meta">
          <span id="rowEditEntityLabel">-</span>
          <span id="rowEditRowLabel" class="row-label">ROW: -</span>
        </div>

        <div id="rowEditFields" class="modal-fields"></div>
      </div>

      <div class="modal-footer">
        <button type="button" id="rowEditSave" class="primary-btn">ì €ì¥</button>
        <button type="button" class="ghost-btn" data-close-modal>ì·¨ì†Œ</button>
      </div>
    </div>

    <!-- ì‚­ì œ ëª¨ë‹¬ -->
    <div
      id="rowDeleteModal"
      class="modal-panel"
      data-type="delete"
      data-modal-delete
      style="display:none;"
    >
      <div class="modal-header">
        <h3 class="modal-title">í–‰ ì‚­ì œ</h3>
        <button type="button" class="modal-close-btn" data-close-modal>âœ•</button>
      </div>

      <div class="modal-body">
        <p id="rowDeleteMessage">
          ì„ íƒí•œ í–‰ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
        </p>
        <div class="modal-meta">
          <span id="rowDeleteEntityLabel">-</span>
          <span id="rowDeleteRowLabel" class="row-label">ROW: -</span>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" id="rowDeleteConfirm" class="primary-btn">ì‚­ì œ</button>
        <button type="button" class="ghost-btn" data-close-modal>ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <!-- JS ì—°ê²° -->
  <script src="app.js"></script>
  <script src="modal.js"></script>

  <!-- ëª¨ë‹¬ ì „ì—­ í—¬í¼ -->
  <script>
    (function () {
      const layer      = document.getElementById("korualModalLayer");
      const backdrop   = document.getElementById("korualModalBackdrop");
      const editModal  = document.getElementById("rowEditModal");
      const deleteModal= document.getElementById("rowDeleteModal");

      function closeAll() {
        if (!layer) return;
        layer.style.display = "none";
        if (editModal)  editModal.style.display = "none";
        if (deleteModal) deleteModal.style.display = "none";
        document.body.classList.remove("modal-open");
      }

      document.querySelectorAll("[data-close-modal]").forEach(btn => {
        btn.addEventListener("click", closeAll);
      });
      if (backdrop) {
        backdrop.addEventListener("click", closeAll);
      }

      window.KORUAL_MODAL = {
        closeAll,

        openEdit(payload) {
          if (!layer || !editModal) return;

          layer.style.display = "flex";
          document.body.classList.add("modal-open");
          editModal.style.display = "block";
          if (deleteModal) deleteModal.style.display = "none";

          const entityLabelMap = {
            members: "íšŒì›",
            orders: "ì£¼ë¬¸",
            products: "ìƒí’ˆ",
            stock: "ì¬ê³ ",
            logs: "ë¡œê·¸"
          };
          const entityName = entityLabelMap[payload.entity] || payload.entity || "-";
          document.getElementById("rowEditEntityLabel").textContent = "[" + entityName + "]";
          document.getElementById("rowEditRowLabel").textContent    = "ROW: " + payload.rowIndex;

          const wrap = document.getElementById("rowEditFields");
          if (!wrap) return;
          wrap.innerHTML = "";

          const data = payload.data || {};
          Object.keys(data).forEach((key) => {
            const field = document.createElement("div");
            field.className = "modal-field-row";

            const label = document.createElement("label");
            label.className = "modal-label";
            label.textContent = key;

            const input = document.createElement("input");
            input.className = "input";
            input.value = data[key] != null ? data[key] : "";
            input.dataset.fieldKey = key;

            field.appendChild(label);
            field.appendChild(input);
            wrap.appendChild(field);
          });

          const saveBtn = document.getElementById("rowEditSave");
          if (saveBtn) {
            saveBtn.dataset.entity   = payload.entity || "";
            saveBtn.dataset.sheet    = payload.sheet  || "";
            saveBtn.dataset.rowIndex = String(payload.rowIndex || "");
          }
        },

        openDelete(payload) {
          if (!layer || !deleteModal) return;

          layer.style.display = "flex";
          document.body.classList.add("modal-open");
          deleteModal.style.display = "block";
          if (editModal) editModal.style.display = "none";

          const entityLabelMap = {
            members: "íšŒì›",
            orders: "ì£¼ë¬¸",
            products: "ìƒí’ˆ",
            stock: "ì¬ê³ ",
            logs: "ë¡œê·¸"
          };
          const entityName = entityLabelMap[payload.entity] || payload.entity || "-";
          document.getElementById("rowDeleteEntityLabel").textContent = "[" + entityName + "]";
          document.getElementById("rowDeleteRowLabel").textContent    = "ROW: " + payload.rowIndex;

          const msg = payload.title
            ? "ë‹¤ìŒ ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?\n" + payload.title
            : "ì„ íƒí•œ í–‰ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?";
          document.getElementById("rowDeleteMessage").textContent = msg;

          const delBtn = document.getElementById("rowDeleteConfirm");
          if (delBtn) {
            delBtn.dataset.entity   = payload.entity || "";
            delBtn.dataset.sheet    = payload.sheet  || "";
            delBtn.dataset.rowIndex = String(payload.rowIndex || "");
          }
        }
      };
    })();
  </script>
</body>
</html>
